# Feature Specification: 辩论可视化前端

**Feature Branch**: `002-debate-visual-frontend`
**Created**: 2025-12-31
**Status**: Ready
**Input**: User description: "我还想再额外做一个可视化的前端，从输入Topic和查看各 Agent、裁判、观众的回答"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 创建并观察辩论 (优先级: P1)

用户通过可视化界面输入辩题，启动一场辩论，并实时观看各 Agent 的发言和评分过程。

**为什么是此优先级**: 这是核心价值 - 让用户能够直观地发起辩论并观察整个辩论过程，是整个可视化的基础功能。

**独立测试**: 用户可以通过输入辩题 → 启动辩论 → 实时观看发言 → 查看结果的完整流程来验证功能。

**验收场景**:

1. **给定** 用户在辩论创建页面，**当** 输入辩题"人工智能是否会取代人类工作"并点击"开始辩论"，**则** 系统显示辩论已启动，进入实时展示页面
2. **给定** 辩论进行中，**当** Agent 发言时，**则** 页面实时显示发言内容，并标明发言方（正方/反方/裁判）和当前回合
3. **给定** 辩论完成，**当** 所有回合结束，**则** 显示最终胜负结果和裁判评分汇总

---

### User Story 2 - 查看辩论历史详情 (优先级: P2)

用户可以浏览历史辩论记录，选择某场辩论查看完整的发言记录和评分详情。

**为什么是此优先级**: 允许用户回顾和分析过往辩论，对于学习和分析有价值，但不是实时观察所必需的。

**独立测试**: 可以通过直接访问已完成辩论的详情页面来验证，能够看到完整的发言历史和评分。

**验收场景**:

1. **给定** 用户在辩论列表页面，**当** 点击某场历史辩论，**则** 进入该辩论的详情页面
2. **给定** 用户在辩论详情页面，**当** 浏览内容时，**则** 可以看到所有回合的发言记录、每轮评分和最终裁决

---

### User Story 3 - 观众参与互动 (优先级: P3)

用户可以作为观众参与辩论，支持某一方，并在适当时机下场发言或投票。

**为什么是此优先级**: 增强互动性，但需要后端观众 Agent 功能的支持，属于增值功能。

**独立测试**: 可以通过在辩论进行中选择支持立场并提交观众发言来验证。

**验收场景**:

1. **给定** 用户在辩论实时页面，**当** Round 3-6 期间，**则** 可以选择支持正方或反方并提交发言内容
2. **给定** 观众提交发言申请，**当** 裁判批准后，**则** 观众发言显示在辩论记录中
3. **给定** 辩论进入最后阶段，**当** 观众投票时，**则** 可以选择最终支持的立场并提交投票

---

### Edge Cases

- 当辩论 API 服务不可用时，前端应显示友好的错误提示并提供重试选项
- 当网络中断后恢复，前端应能够自动重新连接并获取最新状态
- 当多个用户同时观察同一场辩论时，每个人都应看到一致的实时更新
- 当辩论进行中突然失败（如 LLM API 超时），前端应显示失败原因和当前进度
- 当用户在移动端访问时，界面应适配小屏幕显示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须提供辩题输入界面，用户可以输入任意中文辩题
- **FR-002**: 系统必须支持选择正反方使用的 LLM 模型（如 gpt-4o、claude-3.5-sonnet 等）
- **FR-003**: 系统必须在用户点击"开始辩论"后调用后端 API 创建并启动辩论
- **FR-004**: 系统必须实时显示辩论进度，包括当前回合、阶段和双方发言内容
- **FR-005**: 系统必须在每个 Agent 发言后立即展示其内容，按时间顺序排列
- **FR-006**: 系统必须在每个回合结束后显示裁判对该回合的评分（逻辑、反驳、清晰度、论据）
- **FR-007**: 系统必须在辩论完成后显示最终胜负、总分对比和裁判总结
- **FR-008**: 系统必须提供辩论列表页面，显示所有历史辩论记录
- **FR-009**: 系统必须支持点击辩论进入详情页面，查看完整的发言和评分历史
- **FR-010**: 系统必须使用轮询或 WebSocket 方式实时获取辩论状态更新
- **FR-011**: 系统必须在加载状态时显示加载指示器
- **FR-012**: 系统必须在发生错误时显示清晰的错误消息和重试选项
- **FR-013**: 系统必须支持观众在 Round 3-6 期间提交发言申请
- **FR-014**: 系统必须显示观众发言是否被裁判批准
- **FR-015**: 系统必须在辩论结束时收集观众的最终投票
- **FR-016**: 系统必须以不同颜色或样式区分正方、反方、裁判和观众的发言
- **FR-017**: 系统必须显示每个回合的阶段标签（立论、反驳、关键战役、终局攻防、总结陈词）

### Quality Requirements

- **QR-001**: 前端代码必须使用 TypeScript 编写，启用严格类型检查
- **QR-002**: 前端组件必须有单元测试覆盖核心逻辑
- **QR-003**: 所有代码必须通过 ESLint 检查，零错误
- **QR-004**: 关键用户流程必须有端到端测试

### User Experience Requirements

- **UXR-001**: 所有错误消息必须使用中文，清晰描述问题并提供解决建议
- **UXR-002**: 页面响应时间必须在 200ms 内提供视觉反馈
- **UXR-003**: 实时更新必须平滑显示，避免页面闪烁或突兀跳动
- **UXR-004**: 在移动设备和桌面设备上都必须提供良好的可读性和可操作性

### Performance Requirements

- **PR-001**: 页面初始加载时间必须在 3 秒内完成
- **PR-002**: API 轮询间隔不得低于 2 秒，避免过度请求
- **PR-003**: 长列表（如历史记录）必须使用虚拟滚动或分页，支持大量数据
- **PR-004**: 实时更新必须使用增量渲染，避免全页面重绘

### Documentation Requirements

- **DR-001**: 所有用户界面文本必须使用中文
- **DR-002**: 组件和页面必须有中文注释说明其用途
- **DR-003**: 技术术语保留英文原文

### Key Entities

- **辩论 (Debate)**: 代表一场完整的辩论，包含辩题、状态、创建时间、完成时间、胜负结果
- **回合 (Round)**: 辩论中的一个轮次，包含回合序号、阶段（立论/反驳/关键战役/终局攻防/总结陈词）、状态
- **消息 (Message)**: Agent 或观众的发言内容，包含所属回合、发言者 ID、内容类型、创建时间
- **评分 (Score)**: 裁判对 Agent 在某回合的表现评分，包含逻辑、反驳、清晰度、论据四个维度
- **观众申请 (AudienceRequest)**: 观众下场发言的申请，包含支持立场、核心观点、新颖度、置信度、审批状态
- **观众投票 (Vote)**: 观众在辩论结束时对最终胜负的投票，包含支持的立场和置信度

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 30 秒内完成从输入辩题到启动辩论的整个流程
- **SC-002**: 实时更新的延迟不超过 3 秒，用户能够及时看到最新发言
- **SC-003**: 90% 的用户能够首次使用时成功完成创建和观察一场辩论
- **SC-004**: 页面可以同时支持至少 100 个用户并发观看同一场辩论而不卡顿
- **SC-005**: 历史辩论列表可以流畅显示 1000+ 条记录，搜索响应时间在 1 秒内

---

## Assumptions

1. 后端 API 已经按照 001-multi-agent-debate 规格实现完成
2. 前端通过 HTTP/HTTPS 与后端 API 通信
3. 用户使用现代浏览器（Chrome、Firefox、Safari、Edge 的最新版本）访问
4. 辩论过程完全由后端 LLM Agent 驱动，前端只负责展示和用户交互
5. 实时更新通过轮询 API 实现，频率为每 2 秒一次
6. 用户无需登录即可创建和观看辩论（匿名访问）
